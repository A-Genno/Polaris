# エージェント開発ガイドライン

## 1. 本ドキュメントの目的と対象

本ドキュメントは、Polaris プロジェクトにおける **人間の開発メンバー** および **LLM エージェント** の双方が遵守すべき共通ルールと、エージェント特有の運用ルールを定義する。

- 明示がない限り、本ドキュメントの規則は「人間／エージェント共通」とする。
- プロジェクト固有の仕様・要件ドキュメントに矛盾がある場合は、そちらを優先し、本ドキュメントは原則としてガイドライン（原則・推奨）とする。

---

## 2. コミュニケーション規則
- **言語**: チャットでの応答、PR、コミットコメント、コード内コメントは全て日本語で記述
- **確認**: 実装前に必ず要件と設計について確認を取る
  - 仕様の解釈が結果に大きく影響する場合は、ユーザーまたはリーダーエージェントに確認する。
  - 軽微な UI 調整や一貫性維持など、影響範囲が限定的な場合は過去実装との一貫性を優先して自律判断してよい。
- **進捗報告**: 作業の進行状況を適宜報告する

---

## 3. ドキュメント管理

### 3.1 作業記録
- 作業完了後に作業内容を記載した `.md` ファイルを `/documents/agent_logs` ディレクトリ以下に作成する
- ファイルには必ず「意図（なぜその作業を行ったか）」を明記する
- ファイル名は `YYYYMMDD_作業内容.md` 形式を推奨

### 3.2 ドキュメント構成
- **場所**: `documents/` ディレクトリ以下に集約
- **種類**: 要件定義、設計書、API 仕様、運用手順、作業記録、skills
- **更新**: 実装と同期してドキュメントも更新
- **参照**: 実装前に関連ドキュメントの存在を必ず確認

### 3.3 ドキュメント作成ルール
- **言語**: 全て日本語で記述
- **形式**: Markdown 形式を基本とする
- **構成**: 目的、概要、詳細、例の順で構成
- **更新履歴**: 重要な変更は履歴として記録

### 3.4 必要なドキュメント
- **ルール**: タスク開始前に参照するべきドキュメントが存在するかどうか確認すること
- **steering/index.md**: プロジェクト全体の概要に関するドキュメント群の目次
- **skills/index.md**: Agent Skillsの目次
- **references/index.md**: テンプレートや付属リソースなどの目次
- **specs/index.md**: 仕様書(機能要件・AC・画面・API)などの目次

---

## 4. 実装タスクフロー

### 4.1 事前調査フェーズ
- **要件収集**: 実装に必要な情報をユーザーから網羅的に収集
- **仕様明確化**: 曖昧な点や不明な仕様は必ずユーザーに確認
- **既存コード調査**: プロジェクト構成と既存実装を十分に理解

### 4.2 設計フェーズ
- **設計提示**: 実装アプローチと技術選択を明確に提示
- **計画承認**: 設計と実装計画についてユーザーの承認を必ず取得
- **影響範囲確認**: 変更による他コンポーネントへの影響を検討

### 4.3 実装フェーズ
- **段階的実装**: 小さな単位で実装し、動作確認を繰り返す
- **命名規則**: クラス、関数、変数名は自己説明的で意図が明確なものを使用
- **コメント**: 複雑なロジックには適切な日本語コメントを付与
- **セットテスト**: 新規作成したコンポーネントには必ずテストを実装

---

## 5. コード品質基準

### 5.1 設計原則
- **単一責任の原則**: 一つのクラス / 関数は一つの責任のみを持つ
- **開放閉鎖の原則**: 拡張に対して開いており、修正に対して閉じている
- **依存性逆転の原則**: 抽象に依存し、具象に依存しない
- **インターフェース分離の原則**: 使用しないメソッドへの依存を強制しない

### 5.2 コーディング規約
- **命名規則**:
  - クラス: PascalCase（例: `UserRepository`）
  - 関数 / 変数: camelCase（例: `getUserById`）
  - 定数: UPPER_SNAKE_CASE（例: `MAX_RETRY_COUNT`）
- **関数設計**: 一つの関数は 20 行以内、引数は 3 個以内を目標
- **コメント**: WHY を説明し、WHAT は説明しない
- **マジックナンバー**: 定数として定義し、意味のある名前を付ける

### 5.3 リファクタリング指針
- **既存コード調査**: 変更対象の全体像を把握してから着手
- **影響範囲分析**: 変更による他コンポーネントへの影響を事前に確認
- **段階的改善**: 大きな変更は小さな単位に分割して実施
- **後方互換性**: 既存 API の互換性を可能な限り維持

---

## 6. セキュリティガイドライン

### 6.1 機密情報管理
- **環境変数**: `.env.local` を使用し、**絶対にコミットしない**
- **API キー**: 外部サービスの API キーは環境変数で管理
- **データベース認証情報**: 本番・開発環境で異なる認証情報を使用
- **ログ出力**: 個人情報（PII）をログに出力しない

### 6.2 セキュリティチェックリスト
- **SQLインジェクション**: ORM やプリペアドステートメントを使用
- **XSS対策**: 出力時の適切なエスケープ処理
- **CSRF対策**: CSRF トークンの実装
- **認証・認可**: 適切な権限チェックの実装
- **HTTPS**: 本番環境では必ず HTTPS 通信を使用

### 6.3 禁止事項
- 外部 URL への無許可での `curl` 実行
- 機密情報のハードコーディング
- 本番データベースへの直接アクセス
- セキュリティホールを作る可能性のあるライブラリ使用

---

## 7. 開発ツールとコマンド

### 7.1 許可コマンド
- **パッケージ管理**: `pnpm`, `npm`, `pip`
- **バージョン管理**: `git` 全般
- **コンテナ**: `docker`, `docker-compose`
- **クラウド**: `gcloud`（dry-run 優先）
- **データベース**: `psql`, `mysql`
- **テスト**: `jest`, `pytest`

### 7.2 禁止・制限コマンド
- **危険コマンド**: `rm -rf /`, `sudo rm`
- **外部通信**: `curl` での外部送信（明示許可時のみ可）
- **システム変更**: システム設定を変更するコマンド
- **本番環境操作**: 本番データベースの直接操作

---

## 8. Git ワークフローと PR 管理

### 8.1 ブランチ戦略
- **命名規則**: `feat/*`, `fix/*`, `docs/*`, `refactor/*`, `test/*`, `chore/*`
- **ベースブランチ**: 基本的に `main` ブランチから分岐
- **ブランチ寿命**: 機能実装完了後は速やかにマージ・削除
- **並行開発**: 機能ごとに独立したブランチで開発

### 8.2 コミット規約
- **スタイル**: Conventional Commits 形式を厳守
- **例**: `feat: ユーザーログイン機能を追加`, `fix: パスワード検証バグを修正`
- **粒度**: 論理的に関連する変更を一つのコミットにまとめる
- **頻度**: 機能の区切りで定期的にコミット

### 8.3 プルリクエスト作成基準
- **言語**: タイトル・説明文は日本語で記述
- **タイトル**: 実装した機能・修正内容を簡潔に要約
- **概要**: その PR で行った作業を 1 行で明確に記述
- **修正内容**: 変更内容を具体的に箇条書きで詳述
- **テスト**: 実装したテストケースと動作確認結果を記載
- **スクリーンショット**: UI 変更がある場合は変更前後の画像を添付

### 8.4 レビュー観点
- **機能性**: 要求通りに動作するか
- **設計**: アーキテクチャ原則に準拠しているか
- **可読性**: コードが理解しやすいか
- **テスト**: 適切なテストが実装されているか
- **パフォーマンス**: 性能面で問題がないか

---

## 9. エージェント運用ガイドライン
- **運用目的**: リーダーエージェントを中心とした小規模チームを編成し、調査・設計・実装などのタスクを自律的かつ継続的に遂行する枠組みを整える。
- `documents/skills/child-agent-ops.SKILL.md` を参照すること
# エージェント開発ガイドライン

## 1. 本ドキュメントの目的と対象

本ドキュメントは、Polaris プロジェクトにおける **人間の開発メンバー** および **LLM エージェント** の双方が遵守すべき共通ルールと、エージェント特有の運用ルールを定義する。

- 明示がない限り、本ドキュメントの規則は「人間／エージェント共通」とする。
- プロジェクト固有の仕様・要件ドキュメントに矛盾がある場合は、そちらを優先し、本ドキュメントは原則としてガイドライン（原則・推奨）とする。

---

## 2. コミュニケーション規則
- **言語**: チャットでの応答、PR、コミットコメント、コード内コメントは全て日本語で記述
- **確認**: 実装前に必ず要件と設計について確認を取る
  - 仕様の解釈が結果に大きく影響する場合は、ユーザーまたはリーダーエージェントに確認する。
  - 軽微な UI 調整や一貫性維持など、影響範囲が限定的な場合は過去実装との一貫性を優先して自律判断してよい。
- **進捗報告**: 作業の進行状況を適宜報告する

---

## 3. ドキュメント管理

### 3.1 作業記録
- 作業完了後に作業内容を記載した `.md` ファイルを `/documents/agent_logs` ディレクトリ以下に作成する
- ファイルには必ず「意図（なぜその作業を行ったか）」を明記する
- ファイル名は `YYYYMMDD_作業内容.md` 形式を推奨

### 3.2 ドキュメント構成
- **場所**: `documents/` ディレクトリ以下に集約
- **種類**: 要件定義、設計書、API 仕様、運用手順、作業記録、skills
- **更新**: 実装と同期してドキュメントも更新
- **参照**: 実装前に関連ドキュメントの存在を必ず確認

### 3.3 ドキュメント作成ルール
- **言語**: 全て日本語で記述
- **形式**: Markdown 形式を基本とする
- **構成**: 目的、概要、詳細、例の順で構成
- **更新履歴**: 重要な変更は履歴として記録

### 3.4 必要なドキュメント
- **ルール**: タスク開始前に参照するべきドキュメントが存在するかどうか確認すること
- **steering/index.md**: プロジェクト全体の概要に関するドキュメント群の目次
- **skills/index.md**: Agent Skillsの目次
- **references/index.md**: テンプレートや付属リソースなどの目次
- **specs/index.md**: 仕様書(機能要件・AC・画面・API)などの目次

---

## 4. 実装タスクフロー

### 4.1 事前調査フェーズ
- **要件収集**: 実装に必要な情報をユーザーから網羅的に収集
- **仕様明確化**: 曖昧な点や不明な仕様は必ずユーザーに確認
- **既存コード調査**: プロジェクト構成と既存実装を十分に理解

### 4.2 設計フェーズ
- **設計提示**: 実装アプローチと技術選択を明確に提示
- **計画承認**: 設計と実装計画についてユーザーの承認を必ず取得
- **影響範囲確認**: 変更による他コンポーネントへの影響を検討

### 4.3 実装フェーズ
- **段階的実装**: 小さな単位で実装し、動作確認を繰り返す
- **命名規則**: クラス、関数、変数名は自己説明的で意図が明確なものを使用
- **コメント**: 複雑なロジックには適切な日本語コメントを付与
- **セットテスト**: 新規作成したコンポーネントには必ずテストを実装

---

## 5. コード品質基準

### 5.1 設計原則
- **単一責任の原則**: 一つのクラス / 関数は一つの責任のみを持つ
- **開放閉鎖の原則**: 拡張に対して開いており、修正に対して閉じている
- **依存性逆転の原則**: 抽象に依存し、具象に依存しない
- **インターフェース分離の原則**: 使用しないメソッドへの依存を強制しない

### 5.2 コーディング規約
- **命名規則**:
  - クラス: PascalCase（例: `UserRepository`）
  - 関数 / 変数: camelCase（例: `getUserById`）
  - 定数: UPPER_SNAKE_CASE（例: `MAX_RETRY_COUNT`）
- **関数設計**: 一つの関数は 20 行以内、引数は 3 個以内を目標
- **コメント**: WHY を説明し、WHAT は説明しない
- **マジックナンバー**: 定数として定義し、意味のある名前を付ける

### 5.3 リファクタリング指針
- **既存コード調査**: 変更対象の全体像を把握してから着手
- **影響範囲分析**: 変更による他コンポーネントへの影響を事前に確認
- **段階的改善**: 大きな変更は小さな単位に分割して実施
- **後方互換性**: 既存 API の互換性を可能な限り維持

---

## 6. セキュリティガイドライン

### 6.1 機密情報管理
- **環境変数**: `.env.local` を使用し、**絶対にコミットしない**
- **API キー**: 外部サービスの API キーは環境変数で管理
- **データベース認証情報**: 本番・開発環境で異なる認証情報を使用
- **ログ出力**: 個人情報（PII）をログに出力しない

### 6.2 セキュリティチェックリスト
- **SQLインジェクション**: ORM やプリペアドステートメントを使用
- **XSS対策**: 出力時の適切なエスケープ処理
- **CSRF対策**: CSRF トークンの実装
- **認証・認可**: 適切な権限チェックの実装
- **HTTPS**: 本番環境では必ず HTTPS 通信を使用

### 6.3 禁止事項
- 外部 URL への無許可での `curl` 実行
- 機密情報のハードコーディング
- 本番データベースへの直接アクセス
- セキュリティホールを作る可能性のあるライブラリ使用

---

## 7. 開発ツールとコマンド

### 7.1 許可コマンド
- **パッケージ管理**: `pnpm`, `npm`, `pip`
- **バージョン管理**: `git` 全般
- **コンテナ**: `docker`, `docker-compose`
- **クラウド**: `gcloud`（dry-run 優先）
- **データベース**: `psql`, `mysql`
- **テスト**: `jest`, `pytest`

### 7.2 禁止・制限コマンド
- **危険コマンド**: `rm -rf /`, `sudo rm`
- **外部通信**: `curl` での外部送信（明示許可時のみ可）
- **システム変更**: システム設定を変更するコマンド
- **本番環境操作**: 本番データベースの直接操作

---

## 8. Git ワークフローと PR 管理

### 8.1 ブランチ戦略
- **命名規則**: `feat/*`, `fix/*`, `docs/*`, `refactor/*`, `test/*`, `chore/*`
- **ベースブランチ**: 基本的に `main` ブランチから分岐
- **ブランチ寿命**: 機能実装完了後は速やかにマージ・削除
- **並行開発**: 機能ごとに独立したブランチで開発

### 8.2 コミット規約
- **スタイル**: Conventional Commits 形式を厳守
- **例**: `feat: ユーザーログイン機能を追加`, `fix: パスワード検証バグを修正`
- **粒度**: 論理的に関連する変更を一つのコミットにまとめる
- **頻度**: 機能の区切りで定期的にコミット

### 8.3 プルリクエスト作成基準
- **言語**: タイトル・説明文は日本語で記述
- **タイトル**: 実装した機能・修正内容を簡潔に要約
- **概要**: その PR で行った作業を 1 行で明確に記述
- **修正内容**: 変更内容を具体的に箇条書きで詳述
- **テスト**: 実装したテストケースと動作確認結果を記載
- **スクリーンショット**: UI 変更がある場合は変更前後の画像を添付

### 8.4 レビュー観点
- **機能性**: 要求通りに動作するか
- **設計**: アーキテクチャ原則に準拠しているか
- **可読性**: コードが理解しやすいか
- **テスト**: 適切なテストが実装されているか
- **パフォーマンス**: 性能面で問題がないか

---

## 9. エージェント運用ガイドライン
- **運用目的**: リーダーエージェントを中心とした小規模チームを編成し、調査・設計・実装などのタスクを自律的かつ継続的に遂行する枠組みを整える。
- `documents/skills/child-agent-ops.SKILL.md` を参照すること
# エージェント開発ガイドライン

## 1. 本ドキュメントの目的と対象

本ドキュメントは、Polaris プロジェクトにおける **人間の開発メンバー** および **LLM エージェント** の双方が遵守すべき共通ルールと、エージェント特有の運用ルールを定義する。

- 明示がない限り、本ドキュメントの規則は「人間／エージェント共通」とする。
- プロジェクト固有の仕様・要件ドキュメントに矛盾がある場合は、そちらを優先し、本ドキュメントは原則としてガイドライン（原則・推奨）とする。

---

## 2. コミュニケーション規則
- **言語**: チャットでの応答、PR、コミットコメント、コード内コメントは全て日本語で記述
- **確認**: 実装前に必ず要件と設計について確認を取る
  - 仕様の解釈が結果に大きく影響する場合は、ユーザーまたはリーダーエージェントに確認する。
  - 軽微な UI 調整や一貫性維持など、影響範囲が限定的な場合は過去実装との一貫性を優先して自律判断してよい。
- **進捗報告**: 作業の進行状況を適宜報告する

---

## 3. ドキュメント管理

### 3.1 作業記録
- 作業完了後に作業内容を記載した `.md` ファイルを `/documents/agent_logs` ディレクトリ以下に作成する
- ファイルには必ず「意図（なぜその作業を行ったか）」を明記する
- ファイル名は `YYYYMMDD_作業内容.md` 形式を推奨

### 3.2 ドキュメント構成
- **場所**: `documents/` ディレクトリ以下に集約
- **種類**: 要件定義、設計書、API 仕様、運用手順、作業記録、skills
- **更新**: 実装と同期してドキュメントも更新
- **参照**: 実装前に関連ドキュメントの存在を必ず確認

### 3.3 ドキュメント作成ルール
- **言語**: 全て日本語で記述
- **形式**: Markdown 形式を基本とする
- **構成**: 目的、概要、詳細、例の順で構成
- **更新履歴**: 重要な変更は履歴として記録

### 3.4 必要なドキュメント
- **ルール**: タスク開始前に参照するべきドキュメントが存在するかどうか確認すること
- **steering/index.md**: プロジェクト全体の概要に関するドキュメント群の目次
- **skills/index.md**: Agent Skillsの目次
- **references/index.md**: テンプレートや付属リソースなどの目次
- **specs/index.md**: 仕様書(機能要件・AC・画面・API)などの目次

---

## 4. 実装タスクフロー

### 4.1 事前調査フェーズ
- **要件収集**: 実装に必要な情報をユーザーから網羅的に収集
- **仕様明確化**: 曖昧な点や不明な仕様は必ずユーザーに確認
- **既存コード調査**: プロジェクト構成と既存実装を十分に理解

### 4.2 設計フェーズ
- **設計提示**: 実装アプローチと技術選択を明確に提示
- **計画承認**: 設計と実装計画についてユーザーの承認を必ず取得
- **影響範囲確認**: 変更による他コンポーネントへの影響を検討

### 4.3 実装フェーズ
- **段階的実装**: 小さな単位で実装し、動作確認を繰り返す
- **命名規則**: クラス、関数、変数名は自己説明的で意図が明確なものを使用
- **コメント**: 複雑なロジックには適切な日本語コメントを付与
- **セットテスト**: 新規作成したコンポーネントには必ずテストを実装

---

## 5. コード品質基準

### 5.1 設計原則
- **単一責任の原則**: 一つのクラス / 関数は一つの責任のみを持つ
- **開放閉鎖の原則**: 拡張に対して開いており、修正に対して閉じている
- **依存性逆転の原則**: 抽象に依存し、具象に依存しない
- **インターフェース分離の原則**: 使用しないメソッドへの依存を強制しない

### 5.2 コーディング規約
- **命名規則**:
  - クラス: PascalCase（例: `UserRepository`）
  - 関数 / 変数: camelCase（例: `getUserById`）
  - 定数: UPPER_SNAKE_CASE（例: `MAX_RETRY_COUNT`）
- **関数設計**: 一つの関数は 20 行以内、引数は 3 個以内を目標
- **コメント**: WHY を説明し、WHAT は説明しない
- **マジックナンバー**: 定数として定義し、意味のある名前を付ける

### 5.3 リファクタリング指針
- **既存コード調査**: 変更対象の全体像を把握してから着手
- **影響範囲分析**: 変更による他コンポーネントへの影響を事前に確認
- **段階的改善**: 大きな変更は小さな単位に分割して実施
- **後方互換性**: 既存 API の互換性を可能な限り維持

---

## 6. セキュリティガイドライン

### 6.1 機密情報管理
- **環境変数**: `.env.local` を使用し、**絶対にコミットしない**
- **API キー**: 外部サービスの API キーは環境変数で管理
- **データベース認証情報**: 本番・開発環境で異なる認証情報を使用
- **ログ出力**: 個人情報（PII）をログに出力しない

### 6.2 セキュリティチェックリスト
- **SQLインジェクション**: ORM やプリペアドステートメントを使用
- **XSS対策**: 出力時の適切なエスケープ処理
- **CSRF対策**: CSRF トークンの実装
- **認証・認可**: 適切な権限チェックの実装
- **HTTPS**: 本番環境では必ず HTTPS 通信を使用

### 6.3 禁止事項
- 外部 URL への無許可での `curl` 実行
- 機密情報のハードコーディング
- 本番データベースへの直接アクセス
- セキュリティホールを作る可能性のあるライブラリ使用

---

## 7. 開発ツールとコマンド

### 7.1 許可コマンド
- **パッケージ管理**: `pnpm`, `npm`, `pip`
- **バージョン管理**: `git` 全般
- **コンテナ**: `docker`, `docker-compose`
- **クラウド**: `gcloud`（dry-run 優先）
- **データベース**: `psql`, `mysql`
- **テスト**: `jest`, `pytest`

### 7.2 禁止・制限コマンド
- **危険コマンド**: `rm -rf /`, `sudo rm`
- **外部通信**: `curl` での外部送信（明示許可時のみ可）
- **システム変更**: システム設定を変更するコマンド
- **本番環境操作**: 本番データベースの直接操作

---

## 8. Git ワークフローと PR 管理

### 8.1 ブランチ戦略
- **命名規則**: `feat/*`, `fix/*`, `docs/*`, `refactor/*`, `test/*`, `chore/*`
- **ベースブランチ**: 基本的に `main` ブランチから分岐
- **ブランチ寿命**: 機能実装完了後は速やかにマージ・削除
- **並行開発**: 機能ごとに独立したブランチで開発

### 8.2 コミット規約
- **スタイル**: Conventional Commits 形式を厳守
- **例**: `feat: ユーザーログイン機能を追加`, `fix: パスワード検証バグを修正`
- **粒度**: 論理的に関連する変更を一つのコミットにまとめる
- **頻度**: 機能の区切りで定期的にコミット

### 8.3 プルリクエスト作成基準
- **言語**: タイトル・説明文は日本語で記述
- **タイトル**: 実装した機能・修正内容を簡潔に要約
- **概要**: その PR で行った作業を 1 行で明確に記述
- **修正内容**: 変更内容を具体的に箇条書きで詳述
- **テスト**: 実装したテストケースと動作確認結果を記載
- **スクリーンショット**: UI 変更がある場合は変更前後の画像を添付

### 8.4 レビュー観点
- **機能性**: 要求通りに動作するか
- **設計**: アーキテクチャ原則に準拠しているか
- **可読性**: コードが理解しやすいか
- **テスト**: 適切なテストが実装されているか
- **パフォーマンス**: 性能面で問題がないか

---

## 9. エージェント運用ガイドライン
- **運用目的**: リーダーエージェントを中心とした小規模チームを編成し、調査・設計・実装などのタスクを自律的かつ継続的に遂行する枠組みを整える。
- `documents/skills/child-agent-ops.SKILL.md` を参照すること
